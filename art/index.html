<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Art Portfolio</title>
    <meta name="color-scheme" content="dark" />
    <style>
        :root {
            --fg: #e9edf7;
            --muted: #b9c2d7;
            --line: #1b2433;
            --card: #0e1420;
            --gap: 16px;
            --row: 12px;
            --accent: #9fb4ff;
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font: 14px/1.65 ui-monospace, SFMono-Regular, Menlo, monospace;
            color: var(--fg);
            background:
                radial-gradient(1200px 900px at 80% -10%, #1a2440 0%, transparent 60%),
                radial-gradient(1000px 780px at -10% 110%, #2a1331 0%, transparent 60%),
                linear-gradient(180deg, #070a0f, #0b0f14 45%, #0a0f14 100%);
            background-attachment: fixed, fixed, fixed;
            background-repeat: no-repeat;
            background-size: cover, cover, cover;
        }

        .wrap {
            max-width: 1320px;
            margin: 0 auto;
            padding: 24px 18px 56px
        }

        header {
            position: sticky;
            top: 0;
            z-index: 5;
            margin: -24px -18px 18px;
            padding: 12px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            backdrop-filter: saturate(1.05) blur(6px);
            background: linear-gradient(180deg, rgba(10, 14, 20, .85), rgba(10, 14, 20, .35));
            border-bottom: 1px solid var(--line);
        }

        h1 {
            margin: 0;
            font-size: 1.45rem;
            letter-spacing: .35px
        }

        .muted {
            color: var(--muted)
        }

        /* Simpler pastel pill back button */
        .back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            text-decoration: none;
            font-weight: 600;
            letter-spacing: .2px;
            color: var(--accent);
            background: rgba(15, 20, 28, .55);
            border: 1px solid rgba(42, 47, 58, .9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, .25), 0 0 0 1px rgba(143, 211, 255, .12) inset;
            backdrop-filter: blur(6px);
            transition: transform .12s ease, box-shadow .15s ease, border-color .15s ease, background .2s ease;
        }

        .back::before {
            content: "";
            width: 8px;
            height: 8px;
            margin-right: 2px;
            border-left: 2px solid currentColor;
            border-bottom: 2px solid currentColor;
            transform: rotate(45deg);
        }

        .back:hover {
            /* transform: translateY(-1px); */
            border-color: var(--accent);
            box-shadow: 0 2px 14px rgba(88, 166, 255, .18), 0 0 0 1px rgba(143, 211, 255, .35) inset;
            background: rgba(15, 20, 28, .68);
        }

        .back:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(159, 180, 255, .32), 0 0 0 1px rgba(143, 211, 255, .35) inset;
        }

        .group {
            margin: 28px 0 12px
        }

        .group-header {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #dfe6ff;
            letter-spacing: .4px;
            text-transform: capitalize;
            font-size: 1.0rem;
            padding: 2px 2px 10px;
        }

        .group-header::after {
            content: "";
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, var(--line), transparent);
            margin-top: 3px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            grid-auto-rows: var(--row);
            grid-auto-flow: dense;
            gap: var(--gap);
            align-items: start;
        }

        @media (min-width:1200px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (min-width:1500px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        .tile {
            position: relative;
            border-radius: 14px;
            overflow: hidden;
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .00));
            border: 1px solid var(--line);
            box-shadow: 0 8px 24px rgba(0, 0, 0, .35), 0 0 0 1px rgba(255, 255, 255, .02) inset;
            transition: transform .16s ease, box-shadow .2s ease, border-color .2s ease;
            cursor: zoom-in;
        }

        .tile:hover {
            transform: translateY(-2px);
            border-color: rgba(159, 180, 255, .45);
            box-shadow: 0 16px 40px rgba(0, 0, 0, .55), 0 0 0 1px rgba(159, 180, 255, .18) inset;
        }

        .tile img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
            filter: saturate(1.02) contrast(1.03);
        }

        figcaption {
            padding: 8px 10px 10px;
            color: #9fb1d8;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, .04);
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, 0));
        }

        @media (min-width:900px) {
            .span2 {
                grid-column: span 2;
            }
        }

        @media (min-width:1200px) {
            .span3 {
                grid-column: span 3;
            }
        }

        .lb {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: none;
            background: rgba(0, 0, 0, .88)
        }

        .lb.open {
            display: grid;
            grid-template-rows: auto 1fr auto;
            padding: 14px
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px
        }

        .btn {
            border: 1px solid var(--line);
            background: linear-gradient(180deg, rgba(255, 255, 255, .04), rgba(255, 255, 255, .02));
            color: var(--muted);
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer
        }

        .btn:hover {
            background: rgba(255, 255, 255, .08)
        }

        .stage {
            position: relative;
            display: grid;
            place-items: center;
            overflow: hidden
        }

        .hero {
            max-width: min(92vw, 1700px);
            max-height: min(84vh, 92vh);
            border-radius: 12px;
            border: 1px solid var(--line);
            background: #0d0d0d;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .6)
        }

        .nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            display: grid;
            place-items: center;
            border-radius: 999px;
            border: 1px solid rgba(159, 180, 255, .45);
            background: rgba(0, 0, 0, .45);
            color: #9db6ff;
            font-size: 22px;
            cursor: pointer
        }

        .nav.left {
            left: 16px
        }

        .nav.right {
            right: 16px
        }

        .counter {
            text-align: center;
            color: var(--muted)
        }

        .loading {
            opacity: .7
        }
    </style>
    <link rel="icon" href="/hyder/logoV6.png" />
</head>

<body>
    <div class="wrap">
        <header>
            <h1>Art Portfolio</h1>
            <a class="back" href="/hyder#/projects">Back</a>
        </header>

        <p class="muted">Selection of pieces, studies, and experiments. Click any image to view full size.</p>
        <div id="status" class="loading muted">Loading…</div>
        <div id="groups"></div>
    </div>

    <!-- Lightbox -->
    <div id="lb" class="lb" role="dialog" aria-modal="true" aria-label="Artwork viewer">
        <div class="row">
            <div class="muted" id="title"></div>
            <button class="btn" id="closeBtn" type="button">Close (Esc)</button>
        </div>
        <div class="stage" id="stage">
            <button class="nav left" id="prevBtn" aria-label="Previous">‹</button>
            <img id="hero" class="hero" alt="" />
            <button class="nav right" id="nextBtn" aria-label="Next">›</button>
        </div>
        <div class="counter" id="counter"></div>
    </div>

    <script>
        (function () {
            const host = document.getElementById('groups');
            const status = document.getElementById('status');

            const lb = document.getElementById('lb');
            const hero = document.getElementById('hero');
            const titleEl = document.getElementById('title');
            const counter = document.getElementById('counter');
            const closeBtn = document.getElementById('closeBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const stage = document.getElementById('stage');

            function resolveSrc(s) {
                if (!s) return s;
                if (/^https?:\/\//i.test(s)) return s;
                if (s.startsWith('/hyder/')) return s;
                if (s.startsWith('/')) return '/hyder' + s;
                return '/hyder/' + s.replace(/^\.?\//, '');
            }

            function measure(gridEl, tileEl) {
                const cs = getComputedStyle(gridEl);
                const row = parseFloat(cs.getPropertyValue('--row')) || 12;
                const gap = parseFloat(cs.getPropertyValue('--gap')) || 16;
                const h = tileEl.getBoundingClientRect().height;
                tileEl.style.gridRowEnd = `span ${Math.ceil((h + gap) / (row + gap))}`;
            }
            const ros = new WeakMap();
            function observeTile(gridEl, tileEl) {
                let ro = ros.get(gridEl);
                if (!ro) {
                    ro = new ResizeObserver(entries => {
                        for (const e of entries) { if (e.target.classList.contains('tile')) measure(gridEl, e.target); }
                    });
                    ros.set(gridEl, ro);
                }
                ro.observe(tileEl);
            }

            function spanClassFor(group, title, aspect) {
                const g = (group || '').toLowerCase(), t = (title || '').toLowerCase(), wide = aspect && aspect > 1.4;
                if (g === 'painting' || g === 'scratchboard' || g === 'misc') return 'span2';
                if (g === 'speed figure drawings') {
                    if (t === 'fabricwrinklestrio' || t === 'heat') return 'span3';
                    if (t === 'triov1') return 'span2';
                    return wide ? 'span2' : '';
                }
                if (g === 'hands') return wide ? 'span2' : '';
                return wide ? 'span2' : '';
            }

            function reorderForFlow(items, isFeature) {
                const f = [], n = []; items.forEach(x => (isFeature(x) ? f : n).push(x));
                const out = []; let i = 0, j = 0, s = 0;
                while (i < f.length || j < n.length) { if (s % 3 === 0 && i < f.length) out.push(f[i++]); else if (j < n.length) out.push(n[j++]); else if (i < f.length) out.push(f[i++]); s++; }
                return out;
            }

            let flat = []; let idx = 0;
            function openLightbox(i) { idx = i; renderLb(); lb.classList.add('open'); document.body.style.overflow = 'hidden'; history.replaceState(null, '', '#art-' + (idx + 1)); }
            function closeLightbox() { lb.classList.remove('open'); document.body.style.overflow = ''; if (location.hash.startsWith('#art-')) history.replaceState(null, '', location.pathname + location.search); }
            function renderLb() { const it = flat[idx]; if (!it) return; hero.src = it.src; hero.alt = it.title || 'artwork'; titleEl.textContent = it.title || 'Artwork'; counter.textContent = (idx + 1) + ' / ' + flat.length; }
            function prev() { idx = (idx - 1 + flat.length) % flat.length; renderLb(); }
            function next() { idx = (idx + 1) % flat.length; renderLb(); }

            closeBtn.onclick = closeLightbox;
            prevBtn.onclick = e => { e.stopPropagation(); prev(); };
            nextBtn.onclick = e => { e.stopPropagation(); next(); };
            lb.addEventListener('click', e => { if (e.target === lb) closeLightbox(); });
            stage.addEventListener('click', e => { if (e.target === stage) closeLightbox(); });
            window.addEventListener('keydown', e => { if (!lb.classList.contains('open')) return; if (e.key === 'Escape') closeLightbox(); if (e.key === 'ArrowLeft') prev(); if (e.key === 'ArrowRight') next(); });

            async function loadGroups() {
                try { const r = await fetch('./manifest.json', { cache: 'no-store' }); const d = await r.json(); if (d && Array.isArray(d.groups)) return d.groups; }
                catch (e) { console.error('manifest load failed', e); }
                return [];
            }

            function renderGroup(name, items, flatStart) {
                const sec = document.createElement('section'); sec.className = 'group';
                const hdr = document.createElement('div'); hdr.className = 'group-header'; hdr.textContent = name; sec.appendChild(hdr);
                const grid = document.createElement('div'); grid.className = 'grid'; sec.appendChild(grid);

                items.forEach((it, localIdx) => {
                    const fig = document.createElement('figure'); fig.className = 'tile';
                    const img = document.createElement('img'); img.loading = 'lazy'; img.decoding = 'async'; img.src = it.src; img.alt = it.title || 'artwork';
                    const cap = document.createElement('figcaption'); cap.textContent = it.title || '';

                    img.addEventListener('load', () => { const a = img.naturalWidth / Math.max(1, img.naturalHeight); const sc = spanClassFor(name, it.title || '', a); if (sc) fig.classList.add(sc); measure(grid, fig); });
                    img.addEventListener('error', () => { const sc = spanClassFor(name, it.title || '', 1); if (sc) fig.classList.add(sc); measure(grid, fig); });

                    fig.append(img, cap);
                    fig.addEventListener('click', () => openLightbox(flatStart + localIdx));
                    grid.appendChild(fig);
                    observeTile(grid, fig);
                });

                host.appendChild(sec);
            }

            (async function init() {
                const groups = await loadGroups();
                if (!groups.length) { status.textContent = 'No artworks yet.'; return; }
                status.style.display = 'none';

                flat = []; const starts = [];
                groups.forEach(g => {
                    const name = g.name || '';
                    const items = g.items.map(x => ({ src: resolveSrc(x.src), title: x.title || (x.src ? decodeURIComponent((x.src.split('/').pop() || '').replace(/\.[^.]+$/, '')) : '') }));
                    const isFeature = (it) => { const t = (it.title || '').toLowerCase(); if (name.toLowerCase() === 'speed figure drawings') return t === 'fabricwrinklestrio' || t === 'heat' || t === 'triov1'; if (name.toLowerCase() === 'painting' || name.toLowerCase() === 'scratchboard') return true; return false; };
                    const ordered = reorderForFlow(items, isFeature);
                    const start = flat.length; starts.push(start); flat.push(...ordered);
                    renderGroup(name, ordered, start);
                });

                if (location.hash.startsWith('#art-')) { const n = parseInt(location.hash.replace('#art-', ''), 10); if (!isNaN(n) && n >= 1 && n <= flat.length) openLightbox(n - 1); }

                requestAnimationFrame(() => { document.querySelectorAll('.group .grid .tile').forEach(t => measure(t.parentElement, t)); });
            })();
        })();
    </script>
</body>

</html>